---
title: 'Meta-analysis: general'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
```

## Meta-analysis with no adaptive designs

Consider a meta-analysis comprised of _n.studies_ binary outcome trials, all with
sample size _N_. Examine a range of true response probabilities *theta*:

```{r meta}
# Simulate the trials:
nsims <- 10000
theta.MA <- seq(0.1, 0.9, 0.1)
bias <- rep(NA, length(theta.MA))

for(i in 1:length(theta.MA)){
  MA.results <- simMeta(N=100, theta=theta.MA[i], n.studies=5, nsims=nsims)
  wtdmeans <- rep(NA, nsims)
  ses <- rep(NA, nsims)
  for(j in 1:nsims){
    wtdmeans[j] <- weighted.mean(x=MA.results$theta.hat[j, ], w=1/MA.results$se[j, ]^2)
    ses[j] <- m
  }
  bias[i] <- mean(wtdmeans-theta.MA[i])
}
bias.df <- data.frame(bias=bias,
                      theta=theta.MA)
```

```{r plot bias}
ggplot(data=bias.df, mapping=aes(x=theta, y=bias))+
 geom_line()+
  geom_point()+
  labs(x="True response probability theta",
       y="Bias (estimate - theta)",
       title="Bias in meta-analysis",
       subtitle="No adaptive designs")+
  geom_hline(aes(yintercept=0), col="grey", linetype="dashed")+
  ylim(max(abs(bias.df$bias)) * c(-1, 1) )+
  scale_x_continuous(breaks=theta.MA)
```

